\section{Introduction} \label{Sec:intro}

\javascript has emerged as the lingua franca of modern, interactive web applications. 
The interactivity is made possible by the close relation between the Document Object Model (DOM) and the underlying \javascript code.
However, testing modern web applications is challenging.  
To check the application's behaviour from an end-user's perspective, testers often use popular frameworks such as Selenium. 
The main advantage of using these frameworks to write DOM-based tests and assertions is that they require little knowledge about the internal operations performed by the code. 
Rather, the tester needs only basic knowledge of common event sequences to cover important DOM elements to assert. 
%This makes it easier for the tester to write DOM-based test suites.

 
On the other hand, it is more tedious to
write unit test assertions for web applications that have rich interaction with the DOM through their \javascript code. 
This is because the tester needs to precisely understand the full range of interaction between the code level operations of a unit and the DOM level operations of a system, 
and thus may fail to assert the correctness of a particular behaviour when the unit is used as a part of a system. 
Our previous findings \cite{mirshokraie:icst15} indicate that while DOM-based assertions tend to miss the related portion of
code-level failure, more fine grained unit-level assertions can detect such faults. 
Furthermore, finding the root cause of an error during DOM-based testing is much more expensive than during unit testing.
This suggest that we need unit-level tests to complement existing DOM-based test for more effective fault detection and localization.
%The inherent characteristics of unit and DOM-based tests, indicate that they are complementary and that there is a trade-off in individually using each to detect faults. 

Current test generation approaches either produce unit test oracles based on mutation testing techniques \cite{mirshokraie:icst15, fraser:tse12}, or rely on soft oracles \cite{artzi:icse11}. Mutation-based approaches suffer from high computational cost, and the problem of equivalent mutants (which are syntactically different but semantically the same as the original application).
Soft oracles such as HTML validation and runtime exceptions are also limited in that they fail to capture logical and computational errors. 
Recently, Milani Fard \etal \cite{milanifard:ase14} proposed using the DOM-based test suite of a web application to regenerate assertions for newly detected states through exploring alternative paths of the application. However, the new assertions generated by this technique remain at the DOM-level without considering the relation between the \javascript code and the DOM.
In this work, we propose to exploit an existing DOM-based test suite to generate unit-level assertions at the code-level for applications that interact highly with the DOM through the underlying \javascript code. We utilize
existing DOM-dependent assertions as well as useful execution information inferred from a DOM-based test suite to automatically generate assertions used for testing individual \javascript functions. 
{\em To the best of our knowledge, this work is the first to propose an approach for generating unit-level assertions by using existing DOM-based test suites.} 

The main contributions of our work include:
\begin{itemize}[noitemsep]
\item A slicing-based technique to generate unit-level assertions for testing JavaScr\-ipt functions by utilizing existing DOM-based test assertions;
\item A technique for selectively choosing additional DOM elements to assert on that are unchecked in the existing DOM-based test suite;
\item An implementation of our approach in a tool, called \atrina; 
\item An empirical evaluation to assess the efficacy of the approach on seven open-source web applications;
The results show that the assertions generated by \atrina surpass the fault finding capabilities of (1) the human-written DOM-based assertions by 31\% on average, and (2) the state-of-the-art mutation-based assertion generation technique by 26\% on average.
\end{itemize} 